   
<body onload="onLoad();">

<script src="../js/thirdparty/jquery-1.11.3.min.js"></script>
<script src="../js/thirdparty/three/three.min.js"></script>
<script src="../js/thirdparty/three/libs/stats.min.js"></script>
<script src="../js/thirdparty/three/libs/dat.gui.min.js"></script>
<script src="../js/thirdparty/three/controls/OrbitControls.js"></script>

<script src="../js/gl.js"></script>
<script src="../js/gui.js"></script>
<script src="../js/shaders.js"></script>
<script src="../js/raytracer.js"></script>
<script src="../js/gravy.js"></script>

<?/* ------------------------------------------------------------------*/?>
<?/*               gravitational potential definition                  */?>
<?/* ------------------------------------------------------------------*/?>

<script>

function Potential() {}
Potential.prototype.init = function(gravy)
{
    // Mass distribution parameters
    this.mass = {};
    this.mass.separation = 1.0;
    this.mass.m1 = 1.0;
    this.mass.m2 = 0.5;
    this.mass.m3 = 0.25;
    this.mass.m4 = 0.1;

    let camera   = gravy.getCamera();
    let controls = gravy.getControls();
    camera.fov = 45;
    camera.up.set(0, 1, 0);
    camera.position.set(10.0, 5.0, 5.0);
    controls.target.set(10.0, 0.0, 0.0);
}

Potential.prototype.getScale = function()
{
    return 1.0;
}

Potential.prototype.program = function()
{
    /**
    * Potential is in units of c^2, and the masses and distances defined in units of
      the Schwarschild radius of some relevant mass scale (e.g. the total mass of the system).
    */

    return `
    uniform vec3 p1;
    uniform vec3 p2;
    uniform vec3 p3;
    uniform vec3 p4;

    uniform float m1;
    uniform float m2;
    uniform float m3;
    uniform float m4;

    float POTENTIAL(in vec3 X)
    {
        float d1 = length(X - p1);
        float d2 = length(X - p2);
        float d3 = length(X - p3);
        float d4 = length(X - p4);

        return -(m1/d1 + m2/d2 + m3/d3 + m4/d4);
    }`;
}

Potential.prototype.syncProgram = function(gravy, program) 
{ 
    let d = this.mass.separation;
    program.uniform3Fv("p1", [0,  d,  0]);
    program.uniform3Fv("p2", [0, -d,  0]);
    program.uniform3Fv("p3", [0,  0,  d]);
    program.uniform3Fv("p4", [0,  0, -d]);
    program.uniformF("m1", this.mass.m1); 
    program.uniformF("m2", this.mass.m2); 
    program.uniformF("m3", this.mass.m3); 
    program.uniformF("m4", this.mass.m4); 
}

Potential.prototype.getName = function() { return 'A simple four point mass system'; }
Potential.prototype.getURL = function() { return "https://github.com/portsmouth/snelly/blob/master/exampleScenes/helloWorld.html"; }

Potential.prototype.initGui = function(gui) 
{ 
    gui.addSlider(this.mass, {name: 'm1', min: 0.0, max: 10.0});
    gui.addSlider(this.mass, {name: 'm2', min: 0.0, max: 10.0}); 
    gui.addSlider(this.mass, {name: 'm3', min: 0.0, max: 10.0});
    gui.addSlider(this.mass, {name: 'm4', min: 0.0, max: 10.0}); 
    gui.addSlider(this.mass, {name: 'separation', min: 0.0, max: 10.0}); 
}

</script>


<?/* ------------------------------------------------------------------*/?>
<?/*                            main loop                              */?>
<?/* ------------------------------------------------------------------*/?>

<script type="text/javascript">
function onLoad() { gravy = new Gravy(new Potential()); animateLoop(); }
function animateLoop() { gravy.render(); window.requestAnimationFrame(animateLoop); }
</script>

</body>
